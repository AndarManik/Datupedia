<!DOCTYPE html>

<html lang="en">
  <head>
    <link rel="stylesheet" type="text/css" href="styles.css">
    
    <title>Datupedia</title>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM fully loaded and parsed.');
        const inputField = document.getElementById('pagename');
        const suggestionList = document.getElementById('suggestions');

        inputField.addEventListener('input', async () => {
          const query = inputField.value;
          console.log(`Query inputted: ${query}`);
          if (query) {
            const response = await fetch(`/suggestions?query=${query}`);
            console.log('Fetch initiated.');
            
            const suggestions = await response.json();
            console.log(`Received suggestions: ${suggestions}`);
            
            suggestionList.innerHTML = '';
            suggestions.forEach(suggestion => {
              console.log(`Appending suggestion: ${suggestion}`);
              
              const listItem = document.createElement('li');
              listItem.textContent = suggestion;
              listItem.addEventListener('click', () => {
                console.log(`Clicked on suggestion: ${suggestion}. Redirecting...`);
                window.location.href = `/${suggestion}/home`;
              });
              suggestionList.appendChild(listItem);
            });
            suggestionList.style.display = suggestions.length > 0 ? 'block' : 'none';
          } else {
            console.log('Query empty. Hiding suggestions.');
            suggestionList.style.display = 'none';
          }
        });
      });
    </script>
  </head>
  <body>
    <header>
      <h1>Search Datupedia</h1>
    </header>
    <div id="status"></div>
    <input type="text" id="pagename" name="pagename" placeholder="Wikipedia Page Name" required autocomplete="off">
    <ul id="suggestions"></ul>
    <script>
      const ws = new WebSocket('ws://localhost:3000');
      const statusDiv = document.getElementById('status');
  
      ws.addEventListener('message', (event) => {
        statusDiv.innerHTML += `<p>${event.data}</p>`;
      });
    </script>
  </body>
  
</html>
